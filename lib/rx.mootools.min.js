/**
* Copyright 2011 Microsoft Corporation
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

(function(j){var m=j.Rx,k=m.Observable,f=k.createWithDisposable,g=m.Disposable.create,h=m.CompositeDisposable,i=m.RefCountDisposable,l=m.AsyncSubject,o=k.fromMooToolsEvent=function(a,b){return k.create(function(c){var d=function(a){c.onNext(a)};a.addEvent(b,d);return function(){a.removeEvent(b,d)}})},j=function(a){return o(this,a)};Window.implement({addEventAsObservable:j});Document.implement({addEventAsObservable:j});Element.implement({addEventAsObservable:j});Elements.implement({addEventAsObservable:j});
Events.implement({addEventAsObservable:j});k.createMooToolsRequest=function(a){var b=new l,c,d;a.onSuccess=function(a,e){b.onNext({responseText:a,responseXML:e});b.onCompleted()};a.onFailure=function(a){b.onError({kind:"failure",xhr:a})};a.onException=function(a,e){b.onError({kind:"exception",headerName:a,value:e})};try{c=new Request(a),c.send()}catch(e){b.onError(e)}d=new i(g(function(){c&&c.cancel()}));return f(function(a){return new h(b.subscribe(a),d.getDisposable())})};Request.implement({toObservable:function(){var a=
new l,b=this,c;b.addEvents({success:function(b,n){a.onNext({responseXML:n,responseText:b});a.onCompleted()},failure:function(b){a.onError({kind:"failure",xhr:b})},exception:function(b,n){a.onError({kind:"exception",headerName:b,value:n})}});try{b.send()}catch(d){a.onError(d)}c=new i(g(function(){b.cancel()}));return f(function(b){return new h(a.subscribe(b),c.getDisposable())})}});k.createMooToolsJSONRequest=function(a){var b=new l,c,d;a.onSuccess=function(a,e){b.onNext({responseJSON:a,responseText:e});
b.onCompleted()};a.onFailure=function(a){b.onError({kind:"failure",xhr:a})};a.onException=function(a,e){b.onError({kind:"exception",headerName:a,value:e})};try{c=new Request(newOptions),c.send()}catch(e){b.onError(e)}d=new i(g(function(){c&&c.cancel()}));return f(function(a){return new h(b.subscribe(a),d.getDisposable())})};Request.JSON.implement({toObservable:function(){var a=new m.AsyncSubject,b=this,c;b.addEvents({success:function(b,c){a.onNext({responseJSON:b,responseText:c});a.onCompleted()},
failure:function(b){a.onError({kind:"failure",xhr:b})},exception:function(b,c){a.onError({kind:"exception",headerName:b,value:c})}});try{b.send()}catch(d){a.onError(d)}c=new i(g(function(){b.cancel()}));return f(function(b){return new h(a.subscribe(b),c.getDisposable())})}});k.createMooToolsHTMLRequest=function(a){var b=new l,c,d;a.onSuccess=function(a){b.onNext(a);b.onCompleted()};a.onFailure=function(a){b.onError({kind:"failure",xhr:a})};a.onException=function(a,c){b.onError({kind:"exception",headerName:a,
value:c})};try{c=new Request.HTML(newOptions),c.send()}catch(e){b.onError(e)}d=new i(g(function(){c&&c.cancel()}));return f(function(a){return new h(b.subscribe(a),d.getDisposable())})};Request.HTML.implement({toObservable:function(){var a=new l,b=this,c;b.addEvents({success:function(b){a.onNext(b);a.onCompleted()},failure:function(b){a.onError({kind:"failure",xhr:b})},exception:function(b,c){a.onError({kind:"exception",headerName:b,value:c})}});try{b.send()}catch(d){a.onError(d)}c=new i(g(function(){b.cancel()}));
return f(function(b){return new h(a.subscribe(b),c.getDisposable())})}});k.createMooToolsJSONPRequest=function(a){var b=new l,c,d;a.onSuccess=function(a){b.onNext(a);b.onCompleted()};a.onFailure=function(a){b.onError({kind:"failure",xhr:a})};a.onException=function(a,c){b.onError({kind:"exception",headerName:a,value:c})};try{c=new Request.JSONP(a),c.send()}catch(e){b.onError(e)}d=new i(g(function(){c&&c.cancel()}));return f(function(a){return new h(b.subscribe(a),d.getDisposable())})};Request.JSONP&&
Request.JSONP.implement({toObservable:function(){var a=new l,b=this,c;b.addEvents({success:function(b){a.onNext(b);a.onCompleted()},failure:function(b){a.onError({kind:"failure",xhr:b})},exception:function(b,c){a.onError({kind:"exception",headerName:b,value:c})}});try{b.send()}catch(d){a.onError(d)}c=new i(g(function(){b.cancel()}));return f(function(b){return new h(a.subscribe(b),c.getDisposable())})}})})(this);